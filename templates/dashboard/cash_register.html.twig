{% extends 'base.html.twig' %}

{% block title %}
  Contr√¥le de caisse
{% endblock %}

{% block content %}
  <h1>Gestion de la caisse</h1>

  {% if session %}
    <div class="sections-container cash-mgmt">
      <section class="card">
        <p class="state-ok">Caisse ouverte par {{ opened_by }} le {{ opening_at }}</p>
        <div class="cash-summary">
          <p>Fond de caisse : {{ cash_float|number_format(2, ',', ' ') }} ‚Ç¨</p>
          <p>Total des ventes pour la session en cours : {{ total_price }} ‚Ç¨</p>
          <p>Total CB : {{ total_card }} ‚Ç¨</p>
          <p>Total esp√®ces : {{ total_cash }} ‚Ç¨</p>
          <p>Total des pr√©l√®vements effectu√©s : {{ total_withdrawals }} ‚Ç¨</p>
        </div>
        <p class="bold">Solde th√©orique attendu : {{ theoretical_balance }} ‚Ç¨</p>
      </section>

      <section class="card withdrawal">
        <h2>Effectuer un pr√©l√®vement</h2>
        <div>{% include 'partials/flash.html.twig' %}</div>
        {{ form_start(withdrawal_form) }}
        <div class="form-group">
          {{ form_label(withdrawal_form.amount) }}
          {{ form_widget(withdrawal_form.amount) }}
          {% for error in withdrawal_form.amount.vars.errors %}
            <p role="note" class="flash-error">{{ error.message }}</p>
          {% endfor %}
        </div>
        <div class="form-group">
          {{ form_label(withdrawal_form.comment) }}
          {{ form_widget(withdrawal_form.comment) }}
        </div>
        <button type="submit" class="button-primary">Valider le pr√©l√®vement</button>
        {{ form_end(withdrawal_form) }}
      </section>

      <section class="card closure-panel">
        <h2>Cl√¥ture de caisse</h2>
        {{ form_start(coins_count_form) }}
        <div class="section-grid">
          {% for field in coins_count_form %}
            <label>{{ field.vars.label }} {{ form_widget(field) }}</label>
          {% endfor %}
        </div>
        {{ form_end(coins_count_form) }}

        {{ form_start(closure_form) }}
        {# <p>üí∂ Solde th√©orique de la caisse : <span id="theoriticalBalance">{{ theoretical_balance }}</span>‚Ç¨</p>

        <div class="form-group">
          {{ form_label(closure_form.countedBalance) }}
          {{ form_widget(closure_form.countedBalance) }}
        </div> #}

        <article class="balance-section">
          <p>üí∂ Solde th√©orique de la caisse : <span id="theoreticalBalance">{{ theoretical_balance }}</span>‚Ç¨</p>

          <div class="form-group">
            {{ form_label(closure_form.countedBalance) }}
            {{ form_widget(closure_form.countedBalance) }}
          </div>
        </article>

        <article class="comment-toggle-section">
          <div class="form-group">
            {{ form_label(closure_form.discrepancy) }}
            {{ form_widget(closure_form.discrepancy) }}
          </div>
          <button type="button" class="button-grey-shadow note-toggle">
            <i class="ph ph-receipt"></i> √âcrire un commentaire
          </button>

          <div class="form-group hidden">
            {{ form_label(closure_form.note) }}
            {{ form_widget(closure_form.note) }}
          </div>
        </article>

        <button type="submit" class="button-primary">Cl√¥turer la caisse</button>
        {{ form_end(closure_form) }}
      </section>
    </div>
  {% else %}
    <section class="card">
      <p class="alert">Derni√®re caisse ferm√©e par Karine √† 14h30</p>
      <p>Total des ventes de la derni√®re session : 189 ‚Ç¨</p>
    </section>
  {% endif %}
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="{{ asset('js/cash-register.js') }}" type="module"></script>
{% endblock %}
